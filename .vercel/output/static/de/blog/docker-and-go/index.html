<!DOCTYPE html><html lang="en"> <head><!-- Primary Meta Tags --><title>How to optimize a Go deployment with Docker  • Corentin Giaufer Saubert</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><meta name="generator" content="Astro v4.2.8"><!-- Canonical URL --><link rel="canonical" href="https://corentings.dev/de/blog/docker-and-go/"><!-- SEO --><meta name="title" content="How to optimize a Go deployment with Docker  • Corentin Giaufer Saubert"><meta name="description" content="Learn how to optimize a Go deployment with Docker."><meta name="author" content="Corentin GS"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://corentings.dev/de/blog/docker-and-go/"><meta property="og:title" content="How to optimize a Go deployment with Docker "><meta property="og:description" content="Learn how to optimize a Go deployment with Docker."><meta property="og:image" content="https://corentings.dev/_astro/docker-and-go.w4KkOz0f.webp"><meta property="article:author" content="Corentin GS"><meta property="article:published_time" content="2022-11-08T23:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://corentings.dev/de/blog/docker-and-go/"><meta property="twitter:title" content="How to optimize a Go deployment with Docker "><meta property="twitter:description" content="Learn how to optimize a Go deployment with Docker."><meta property="twitter:image" content="https://corentings.dev/_astro/docker-and-go.w4KkOz0f.webp"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Corentin Giaufer Saubert" href="/rss.xml"><!-- Hachyderm --><link rel="me" href="https://hachyderm.io/@TheLittlePrince"><!-- Umami --><script async src="https://umami.memnix.app/script.js" data-website-id="5bf74955-9bdd-4461-8b7b-3d3aacaf94bb" data-domains="corentings.dev"></script><!-- Schema --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Corentin Giaufer--Saubert","alternateName":"CorentinGS","jobTitle":"Freelance Backend Developer","description":"I&apos;m a 20-year-old freelance backend developer and BSC. Computer Science student with a passion for technology and open-source. Explore my projects, including Memnix, an open-source flashcard app, and discover vibrant communities I manage. Join me on an innovative journey through technology and creativity.","alumniOf":{"@type":"CollegeOrUniversity","name":["Estaca","Université Côte d&apos;Azur","IU International University of Applied Sciences"]},"url":"https://corentings.dev","image":"https://corentings.dev/favicon-32x32.png","sameAs":["https://twitter.com/GSCorentinDev","https://www.linkedin.com/in/corentin-giaufer-saubert/","https://github.com/corentings","https://hachyderm.io/@TheLittlePrince"],"memberOf":[{"@type":"Organization","name":"The Kafejo","url":"https://corentings.dev/discord"},{"@type":"Organization","name":"Memnix","url":"https://memnix.app"}],"knowsAbout":["Golang","Linux","Docker","Computer Science","Chess","C/C++"],"email":"contact@corentings.dev","knowsLanguage":["French","English"],"worksFor":{"@type":"Organization","name":"CorentinGS","url":"https://corentings.dev"}}</script><!-- Fonts --><style>@font-face {font-weight: 400;font-style: normal;font-family: Lufga;font-display: swap;src: url(/fonts/Lufga-Regular.woff2)}</style><style>@font-face {font-weight: 700;font-style: bold;font-family: Lufga;font-display: swap;src: url(/fonts/Lufga-Bold.woff2)}</style><style>body { font-family: Lufga, '_font_fallback_685622536278', sans-serif; } @font-face { font-family: '_font_fallback_685622536278'; size-adjust: 110.48%; src: local('Arial'); ascent-override: 87.82%; descent-override: 30.32%; line-gap-override: 0.00%; }</style><link rel="alternate" hreflang="x-default" href="https://corentings.dev/blog/docker-and-go"><link rel="alternate" hreflang="de" href="https://corentings.dev/de/blog/docker-and-go"><link rel="alternate" hreflang="en" href="https://corentings.dev/blog/docker-and-go"><link rel="alternate" hreflang="fr" href="https://corentings.dev/fr/blog/docker-and-go"><script>
	// ☝️ This script prevent the FART effect.
	if (localStorage.getItem('theme') === null) {
		document.documentElement.setAttribute('data-theme', 'dark')
	} else document.documentElement.setAttribute('data-theme', localStorage.getItem('theme'))
	// "theme" LocalStorage value is set by the package to remember user preference.
	// The value is checked and applyed before rendering anything.
</script> <link rel="stylesheet" href="/_astro/_slug_.Fp4q3cIN.css" />
<link rel="stylesheet" href="/_astro/_slug_.Cfj9ATC3.css" />
<style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
</style><script type="module" src="/_astro/hoisted.QPbhR1uE.js"></script>
<script type="module" src="/_astro/page.nDAPtdgv.js"></script><style>[data-astro-transition-scope="astro-ion6hrkg-1"] { view-transition-name: astro-ion6hrkg-1; }@layer astro { ::view-transition-old(astro-ion6hrkg-1) { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }::view-transition-new(astro-ion6hrkg-1) { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back]::view-transition-old(astro-ion6hrkg-1) { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back]::view-transition-new(astro-ion6hrkg-1) { 
	animation-name: astroFadeIn, astroSlideFromLeft; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-name: astroFadeIn, astroSlideFromLeft; }</style></head> <body> <main data-astro-transition-scope="astro-ion6hrkg-1"> <!-- Navbar --> <header class=""> <nav class="mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8" aria-label="Global"> <div class="flex lg:flex-1"> <a href="/de" class="hoveranimation -m-1.5 flex p-1.5 text-xl normal-case lg:text-3xl"> <span class="sr-only">Corentin GS</span> <svg class="size-16 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <path d="M297.31 360.7q66.63 3.67 132.57 13.74c20.83 3.18 41.57 7.41 62.3 11.19 2.43.45 6.05 3.48 3.87 6.19-1.41 1.74-6.05 1.54-7.8 1.19-64.69-12.87-130.07-20.15-195.94-22.32a.9.9 0 0 0-.83.49q-10.69 21.56-21.72 43.14-2.25 4.4-3.59 5.84c-2.43 2.6-6.88 1.04-7.68-2.4q-.29-1.28.91-4.08 9.3-21.72 18.95-43.2a.25.24 12.7 0 0-.22-.34q-37.42-1.19-74.85-.15a.85.83 11.9 0 0-.72.46q-10.53 21.34-21.4 42.88c-1.11 2.2-2.66 4.85-3.88 6.43-1.83 2.38-5.95 2.08-7.46-.49-1.19-2.02-.09-4.15.77-6.18q8.93-21.13 18.21-42.1.22-.49-.31-.47-33.23 1.27-66.25 4.73-11.49 1.2-12.44 1.41c-8.82 1.96-14.91 9.67-20.99 15.65-15.29 15.04-32.5 29.4-54.81 31.42-9.16.83-24.57-2.63-23-15.3 2.68-21.69 48.7-31.96 65.95-35.88 9.21-2.09 16.58-4.45 21.99-10.87q28.81-34.15 58.31-80.18c54.29-84.7 99.07-176.27 134.91-270.21q1.83-4.79 3.32-6.3c3.68-3.72 12.27-3.05 11.83 4-.27 4.39-2.39 11.12-4.31 16.12q-36.79 95.54-86.1 185.26c-27.83 50.64-58.74 99.64-94.28 145.26q-2.35 3.01-3.77 6.72a1.86 1.86 0 0 0 1.1 2.42q2.26.82 5.05.46 33.99-4.41 68.2-5.75a1.24 1.24 0 0 0 1.07-.71q12.27-26.59 24.88-53.01c6.84-14.32 12.76-28.9 18.96-43.44.68-1.59 2.48-5.63 4.01-6.46 2.9-1.58 7.47-1.21 8.95 2.08 1.72 3.86-1.8 7.32-.18 10.55q.21.43.68.53c2.86.58 5.64-2.41 7.59-3.35 10.03-4.8 25.53-12.43 33.41-1.76q1.24 1.68 3.45 7.38c1.44 3.72 8.7 2.23 11.68 1.46q8.07-2.1 16.26-3.79a1 .98-83.3 0 0 .7-.56q1.39-3.1 2.84-6.19c2.08-4.39 3-7.71 8.02-7.23 6.89.66 5.35 6.43 4.23 10.98a2.31 2.29-46.6 0 0 .03 1.21q.99 3.17 4.2 1.25c9.75-5.8 30.32-17.06 38.62-3.33q1.4 2.31 2.59 5.92c1.92 5.8 19.02.22 23.45-1.04q4.7-1.33 10.05-.81a1.7 1.7 0 0 1 1.52 1.48c.33 2.64-1.31 2.93-3.27 3.61q-14.99 5.24-30.04 10.33c-4.78 1.62-7.64 7.86-10.62 11.6-12.76 16.07-35.92 21.17-55.29 21.07q-.51-.01-.91.3c-4.01 3.06-7.16 9.79-9.39 14.45-4.51 9.41-9.19 18.72-13.72 28.12q-.26.55.34.58Zm-23.37-92.28q-23.22 11.53-37.03 32.48-1.02 1.54-1.04 2.95a1.29 1.29 0 0 0 1.7 1.25q7.46-2.48 14.22-6.54 5.81-3.49 26.05-16.5 2.5-1.6 3.36-3.56 2.02-4.63-.43-9.74a1.47 1.45-.4 0 0-.72-.7q-2.84-1.27-6.11.36Zm58.87 34.43c12.01-5.89 22.8-13.69 34.17-20.68q2.52-1.55 3.4-3.5c1.87-4.13 1.19-14.21-6.39-10.64q-23.66 11.14-38.03 33.39-.77 1.19-.88 2.43a1.11 1.11 0 0 0 1.34 1.19q3.47-.76 6.39-2.19Zm-11.58-26.03q.12-.28-.17-.19-10.66 3.56-21.39 7.27c-7.4 2.56-8.66 7.47-13.17 12.96-12.74 15.54-35.85 20.49-54.86 20.4q-.5-.01-.9.32c-4.8 3.94-8.83 13.11-11.33 18.39q-5.38 11.4-10.95 22.61a.23.22 12 0 0 .21.32c24.67-.59 49.15.07 73.82.93q.52.02.74-.45c12.73-27.53 26.11-54.68 38-82.56ZM72.01 386.45c-14.21.93-29.09 6.14-40.21 15.2-8.15 6.63-3.92 15.07 6.69 10.88q20.65-8.14 33.79-25.57.41-.55-.27-.51Z"></path> </svg> </a> </div> <div class="flex lg:hidden"> <label for="my-modal-6" class="btn btn-ghost lg:hidden"> <svg class="inline-block size-6 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path> </svg> </label> </div> <div class="hidden lg:flex lg:gap-x-12"> <a href="/de/projects" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Projects</a> <a href="/de/talks" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Talks</a> <a href="/de/experiences" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Erlebnisse</a> <a href="/de/blog" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Artikel</a> </div> <div class="hidden lg:flex lg:flex-1 lg:justify-end"> <button class="btn btn-ghost" onclick="my_modal_1.showModal()"> <svg viewBox="0 0 24 24" class="size-6" astro-icon="lucide:settings"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2"/><circle cx="12" cy="12" r="3"/></g></svg> </button> <dialog id="my_modal_1" class="modal"> <div class="modal-box"> <!-- Modal header --> <div class="flex items-center justify-between rounded-t border-b p-4 md:p-5"> <h3 class="text-lg font-semibold">Customize your experience</h3> <form method="dialog"> <button class="btn btn-ghost" data-modal-close> <svg class="size-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </form> </div> <!-- Modal body --> <form action="#" class="p-4 md:p-5"> <div class="mb-4 grid grid-cols-2 gap-4"> <div class="col-span-2"> <label for="theme" class="mb-2 block text-sm font-medium">Theme</label> <select data-choose-theme id="theme-select" name="theme-option" class="select select-bordered select-secondary select-md max-w-xs bg-base-200 text-base-content"> <option disabled selected>Pick your theme</option> <option value="light">Light</option><option value="dark">Dark</option><option value="dracula">Dracula</option><option value="memnix">Memnix</option><option value="luxury">Luxury</option><option value="cyberpunk">Cyberpunk</option><option value="black">Black</option> </select>   </div> </div> </form> </div> <form method="dialog" class="modal-backdrop"> <button>close</button> </form> </dialog> </div> </nav> <!-- Main modal --> <!-- Mobile menu, show/hide based on menu open state. --> </header> <!-- Page Slot --> <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none relative"> <div class="hoveranimation absolute left-5 top-[0.5rem] z-10 hidden lg:block"> <a href="/blog" class="btn btn-ghost text-xl md:text-2xl lg:text-3xl" data-astro-prefetch="hover"> <svg viewBox="0 0 24 24" class="h-10 w-10" astro-icon="lucide:arrow-left"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19-7-7 7-7m7 7H5"/></svg> </a> </div> <div class="mx-auto mt-12 max-w-screen-lg px-4 text-lg leading-relaxed lg:px-0"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published
<time class="text-sm font-bold text-opacity-60" datetime="2022-11-08T23:00:00.000Z"> Nov 9, 2022 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 4 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> How to optimize a Go deployment with Docker  </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Optimization </span> </div><div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Docker </span> </div><div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Golang </span> </div> </div> </header> <picture> <source srcset="/_astro/docker-and-go.w4KkOz0f_2w5bcF.webp" type="image/webp"><source srcset="/_astro/docker-and-go.w4KkOz0f_1NNq04.avif" type="image/avif"> <img src="/_astro/docker-and-go.w4KkOz0f_1CNyeS.png" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of How to optimize a Go deployment with Docker " width="1000" height="500" decoding="async"> </picture> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://corentings.dev/de/blog/docker-and-go/" aria-label="Share on Twitter"> <svg viewBox="0 0 24 24" class="hoveranimation size-6" astro-icon="ri:twitter-x-fill"><path fill="currentColor" d="M18.205 2.25h3.308l-7.227 8.26 8.502 11.24H16.13l-5.214-6.817L4.95 21.75H1.64l7.73-8.835L1.215 2.25H8.04l4.713 6.231zm-1.161 17.52h1.833L7.045 4.126H5.078z"/></svg> </a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://corentings.dev/de/blog/docker-and-go/" aria-label="Share on LinkedIn"> <svg viewBox="0 0 24 24" class="hoveranimation size-6" astro-icon="lucide:linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg> </a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs"> <h2 class="font-bold mb-3 text-2xl">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#how-to-optimize-a-go-deployment-with-docker" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> How to optimize a Go deployment with Docker ? </a>  </li><li class="flex flex-col"> <a href="#a-simple-dockerfile" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> A simple Dockerfile </a>  </li><li class="flex flex-col"> <a href="#the-first-step-using-a-multi-stage-build" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> The first step: using a multi-stage build </a>  </li><li class="flex flex-col"> <a href="#improve-the-build-process" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Improve the build process </a>  </li><li class="flex flex-col"> <a href="#conclusion" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Conclusion </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full text-justify"> <h2 id="how-to-optimize-a-go-deployment-with-docker">How to optimize a Go deployment with Docker ?</h2>
<br/>
<p>In this article, I will present the different steps that led me to optimize the deployment of services in <strong>golang</strong>
using <strong>docker</strong>.</p>
<br/>
<h2 id="a-simple-dockerfile">A simple Dockerfile</h2>
<br/>
<p>When I started Go and deployed a rest api service for my Memnix application, I used a very simple Dockerfile
that I had found on the internet.</p>
<br/>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#F78C6C">FROM</span><span style="color:#BABED8"> golang:1.19</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> mkdir -p /go/src/myapp</span></span>
<span class="line"><span style="color:#F78C6C">WORKDIR</span><span style="color:#BABED8"> /go/src/myapp</span></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> . /go/src/myapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go get -d -v</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go install -v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">EXPOSE</span><span style="color:#BABED8"> 8080</span></span>
<span class="line"><span style="color:#F78C6C">CMD</span><span style="color:#BABED8"> [</span><span style="color:#C3E88D">&quot;/go/bin/myapp&quot;</span><span style="color:#BABED8">]</span></span></code></pre> 
<br/>
<p>The problem is that I ended up with a 2GB image while my project compiled locally without docker and optimized was only 10MB! So I decided to try to optimize the size of my Docker image as much as possible.</p>
<br/>
<h2 id="the-first-step-using-a-multi-stage-build">The first step: using a multi-stage build</h2>
<br/>
<p>It is possible to separate our Dockerfile in several parts and to use several images:</p>
<ul>
<li>
<p>One image to build the project</p>
</li>
<li>
<p>A minimalist image to deploy it</p>
<br/>
</li>
</ul>
<p>This method allows us not to keep the sources and all the development tools provided with the golang image.
Thus, we only keep the binaries.
I decided to use the <strong>golang:1.19-alpine</strong> image as the <strong>builder</strong>.</p>
<br/>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#F78C6C">FROM</span><span style="color:#BABED8"> golang:1.19-alpine </span><span style="color:#F78C6C">as</span><span style="color:#BABED8"> builder</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">LABEL</span><span style="color:#BABED8"> stage=gobuilder</span></span>
<span class="line"><span style="color:#F78C6C">ENV</span><span style="color:#BABED8"> CGO_ENABLED=0</span></span>
<span class="line"><span style="color:#F78C6C">ENV</span><span style="color:#BABED8"> GOOS linux</span></span>
<span class="line"><span style="color:#F78C6C">WORKDIR</span><span style="color:#BABED8"> /build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> go.mod go.sum .</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> . .</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go get -d -v</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go build -o /app/myapp .</span></span></code></pre> 
<br/>
<p>This first part of the Dockerfile allows us to copy the sources, to synchronize the packages and to launch the command go build to generate the binary.
Once the build is finished, we use a minimalist alpine image that will be used for deployment. We just need to copy the binary from our builder and run it.</p>
<br/>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#F78C6C">FROM</span><span style="color:#BABED8"> alpine:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">WORKDIR</span><span style="color:#BABED8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> --from=builder /app/myapp .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">EXPOSE</span><span style="color:#BABED8"> 8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">CMD</span><span style="color:#BABED8"> [</span><span style="color:#C3E88D">&quot;/app/myapp&quot;</span><span style="color:#BABED8">]</span></span></code></pre> 
<br/>
<p>After testing this new Dockerfile, the final image was 34MB. It’s far from the original 10MB but it’s still much better than 2GB.</p>
<br/>
<h2 id="improve-the-build-process">Improve the build process</h2>
<br/>
<p>It is possible in Golang to add flags to the build command in order to slightly optimize the binary size.
After a little research on internet, I discovered the existence of “-s -w” flags. After testing them locally, I noticed an improvement of a few MB so I decided to add them to my Dockerfile.
I also discovered <a href="https://upx.github.io/" class="font-bold underline text-accent">Upx</a> which is a small program that allows to compress binary files to reduce their size.
I tested this little software in a terminal and I noticed an improvement of almost <b>50%</b> on the size of the Memnix api. So I also added this step to my Dockerfile.</p>
<br/>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#F78C6C">FROM</span><span style="color:#BABED8"> golang:1.19-alpine </span><span style="color:#F78C6C">as</span><span style="color:#BABED8"> builder</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">LABEL</span><span style="color:#BABED8"> stage=gobuilder</span></span>
<span class="line"><span style="color:#F78C6C">ENV</span><span style="color:#BABED8"> CGO_ENABLED=0</span></span>
<span class="line"><span style="color:#F78C6C">ENV</span><span style="color:#BABED8"> GOOS linux</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> apk update --no-cache &amp;&amp; apk add upx</span></span>
<span class="line"><span style="color:#F78C6C">WORKDIR</span><span style="color:#BABED8"> /build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> go.mod go.sum .</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> . .</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go get -d -v</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> go build -ldflags=</span><span style="color:#C3E88D">&quot;-s -w&quot;</span><span style="color:#BABED8">  -o /app/myapp .</span></span>
<span class="line"><span style="color:#F78C6C">RUN</span><span style="color:#BABED8"> upx /app/myapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">FROM</span><span style="color:#BABED8"> alpine:3.14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">WORKDIR</span><span style="color:#BABED8"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">COPY</span><span style="color:#BABED8"> --from=builder /app/myapp .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">EXPOSE</span><span style="color:#BABED8"> 8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C">CMD</span><span style="color:#BABED8"> [</span><span style="color:#C3E88D">&quot;/app/myapp&quot;</span><span style="color:#BABED8">]</span></span></code></pre> 
<br/>
<p>And here is my new Dockerfile! It may seem much longer and more complex than the first version but in the end, the result is very interesting. After testing this new Dockerfile, the final image is 16Mb so only 6Mb more than the version without Docker which is almost negligible.</p>
<br/>
<h2 id="conclusion">Conclusion</h2>
<br/>
<p>Docker is a great tool to simplify application development and deployment, but it can be problematic if used incorrectly. This experience helped me understand how to better use Docker and how to optimize my images.
This article is inspired by a <a href="https://twitter.com/GSCorentinDev/status/1564536030795075585?s=20&#38;t=l2hgvKBPDMVs4pS6um2HeA" class="font-bold underline text-accent">twitter thread</a> and the complete code of my Dockerfile is available on my <a href="https://github.com/memnix/memnix-rest/blob/e8e52b3d10731df5b2767f0d24bcdcb5d13d72e3/Dockerfile" class="font-bold underline text-accent">github</a>.
I hope this first article will interest you, don’t hesitate to give me feedback so I can improve for the next articles and share your tips on Docker or Golang!</p>
<br/>
<p>Here is a small infographic that summarizes the evolution of our Docker image.
It’s in French but I think you can understand it anyway.</p>
<br/>
<p><img src="/_astro/docker_infographie.xwFb1ZxH_Z18fVBz.webp" alt="Docker Infographic" width="800" height="2000" loading="lazy" decoding="async"></p>
<img src="../../assets/docker_infographie.jpg" alt="Docker Infographic"/> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related articles</h2> <section class="flex flex-col sm:justify-between gap-8"> <div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/mergesort-parallel.XNL7amaF_ZMFX4k.webp" type="image/webp"><source srcset="/_astro/mergesort-parallel.XNL7amaF_Z28umRf.avif" type="image/avif"> <img src="/_astro/mergesort-parallel.XNL7amaF_Z1TUFgm.png" class="w-16 h-16 object-cover rounded-full " alt="img of Merge Sort using Goroutines" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/mergesort-parallel/"> Merge Sort using Goroutines </a> </header> </div><div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_ZLoKBz.webp" type="image/webp"><source srcset="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_WjJs7.avif" type="image/avif"> <img src="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_2u8xdG.png" class="w-16 h-16 object-cover rounded-full " alt="img of Solving the Sum of Squares Problem: Optimizing Performance" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/optimizing-goroutines-sum-of-squares/"> Solving the Sum of Squares Problem: Optimizing Performance </a> </header> </div><div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/simple-go-vs-goroutines.UC2nTv5T_Z2wkQu8.webp" type="image/webp"><source srcset="/_astro/simple-go-vs-goroutines.UC2nTv5T_1fuYAo.avif" type="image/avif"> <img src="/_astro/simple-go-vs-goroutines.UC2nTv5T_s1por.png" class="w-16 h-16 object-cover rounded-full " alt="img of Goroutine vs Simple function" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/simple-go-vs-goroutines/"> Goroutine vs Simple function </a> </header> </div> </section> </footer> </article> </div>  </div> </div> </article> <div class="hoveranimation btn btn-accent btn-sm fixed bottom-5 right-5 hidden" id="btn-back-to-top"> <svg viewBox="0 0 24 24" class="size-6" astro-icon="lucide:arrow-up"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12 7-7 7 7m-7 7V5"/></svg> </div> <input type="checkbox" id="my-modal-6" class="modal-toggle"> <label for="my-modal-6" class="modal modal-bottom cursor-pointer sm:modal-middle"> <label class="modal-box relative" for=""> <ul class="menu w-80 overflow-y-auto bg-base-100 p-4"> <li class="py-3"> <select data-choose-theme id="theme-select" name="theme-option" class="select select-bordered select-secondary select-md max-w-xs bg-base-200 text-base-content"> <option disabled selected>Pick your theme</option> <option value="light">Light</option><option value="dark">Dark</option><option value="dracula">Dracula</option><option value="memnix">Memnix</option><option value="luxury">Luxury</option><option value="cyberpunk">Cyberpunk</option><option value="black">Black</option> </select>   </li> <li> <a href="/de/projects" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Projects</a> </li> <li> <a href="/de/talks" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Talks</a> </li> <li> <a href="/de/experiences" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Experiences</a> </li> <li> <a href="/de/blog" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Articles</a> </li> </ul> </label> </label> </main>  </body> </html>