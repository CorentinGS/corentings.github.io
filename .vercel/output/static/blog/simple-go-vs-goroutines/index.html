<!DOCTYPE html><html lang="en"> <head><!-- Primary Meta Tags --><title>Goroutine vs Simple function • Corentin Giaufer Saubert</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><meta name="generator" content="Astro v4.2.8"><!-- Canonical URL --><link rel="canonical" href="https://corentings.dev/blog/simple-go-vs-goroutines/"><!-- SEO --><meta name="title" content="Goroutine vs Simple function • Corentin Giaufer Saubert"><meta name="description" content="Goroutine vs Simple function"><meta name="author" content="Corentin GS"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://corentings.dev/blog/simple-go-vs-goroutines/"><meta property="og:title" content="Goroutine vs Simple function"><meta property="og:description" content="Goroutine vs Simple function"><meta property="og:image" content="https://corentings.dev/_astro/simple-go-vs-goroutines.UC2nTv5T.webp"><meta property="article:author" content="Corentin GS"><meta property="article:published_time" content="2023-01-11T23:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://corentings.dev/blog/simple-go-vs-goroutines/"><meta property="twitter:title" content="Goroutine vs Simple function"><meta property="twitter:description" content="Goroutine vs Simple function"><meta property="twitter:image" content="https://corentings.dev/_astro/simple-go-vs-goroutines.UC2nTv5T.webp"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Corentin Giaufer Saubert" href="/rss.xml"><!-- Hachyderm --><link rel="me" href="https://hachyderm.io/@TheLittlePrince"><!-- Umami --><script async src="https://umami.memnix.app/script.js" data-website-id="5bf74955-9bdd-4461-8b7b-3d3aacaf94bb" data-domains="corentings.dev"></script><!-- Schema --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Corentin Giaufer--Saubert","alternateName":"CorentinGS","jobTitle":"Freelance Backend Developer","description":"I&apos;m a 20-year-old freelance backend developer and BSC. Computer Science student with a passion for technology and open-source. Explore my projects, including Memnix, an open-source flashcard app, and discover vibrant communities I manage. Join me on an innovative journey through technology and creativity.","alumniOf":{"@type":"CollegeOrUniversity","name":["Estaca","Université Côte d&apos;Azur","IU International University of Applied Sciences"]},"url":"https://corentings.dev","image":"https://corentings.dev/favicon-32x32.png","sameAs":["https://twitter.com/GSCorentinDev","https://www.linkedin.com/in/corentin-giaufer-saubert/","https://github.com/corentings","https://hachyderm.io/@TheLittlePrince"],"memberOf":[{"@type":"Organization","name":"The Kafejo","url":"https://corentings.dev/discord"},{"@type":"Organization","name":"Memnix","url":"https://memnix.app"}],"knowsAbout":["Golang","Linux","Docker","Computer Science","Chess","C/C++"],"email":"contact@corentings.dev","knowsLanguage":["French","English"],"worksFor":{"@type":"Organization","name":"CorentinGS","url":"https://corentings.dev"}}</script><!-- Fonts --><style>@font-face {font-weight: 400;font-style: normal;font-family: Lufga;font-display: swap;src: url(/fonts/Lufga-Regular.woff2)}</style><style>@font-face {font-weight: 700;font-style: bold;font-family: Lufga;font-display: swap;src: url(/fonts/Lufga-Bold.woff2)}</style><style>body { font-family: Lufga, '_font_fallback_1310562728213', sans-serif; } @font-face { font-family: '_font_fallback_1310562728213'; size-adjust: 110.48%; src: local('Arial'); ascent-override: 87.82%; descent-override: 30.32%; line-gap-override: 0.00%; }</style><link rel="alternate" hreflang="x-default" href="https://corentings.dev/blog/simple-go-vs-goroutines"><link rel="alternate" hreflang="en" href="https://corentings.dev/blog/simple-go-vs-goroutines"><link rel="alternate" hreflang="fr" href="https://corentings.dev/fr/blog/simple-go-vs-goroutines"><link rel="alternate" hreflang="de" href="https://corentings.dev/de/blog/simple-go-vs-goroutines"><script>
	// ☝️ This script prevent the FART effect.
	if (localStorage.getItem('theme') === null) {
		document.documentElement.setAttribute('data-theme', 'dark')
	} else document.documentElement.setAttribute('data-theme', localStorage.getItem('theme'))
	// "theme" LocalStorage value is set by the package to remember user preference.
	// The value is checked and applyed before rendering anything.
</script> <link rel="stylesheet" href="/_astro/_slug_.Fp4q3cIN.css" />
<link rel="stylesheet" href="/_astro/_slug_.Cfj9ATC3.css" />
<style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
</style><script type="module" src="/_astro/hoisted.QPbhR1uE.js"></script>
<script type="module" src="/_astro/page.nDAPtdgv.js"></script><style>[data-astro-transition-scope="astro-ion6hrkg-1"] { view-transition-name: astro-ion6hrkg-1; }@layer astro { ::view-transition-old(astro-ion6hrkg-1) { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }::view-transition-new(astro-ion6hrkg-1) { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back]::view-transition-old(astro-ion6hrkg-1) { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back]::view-transition-new(astro-ion6hrkg-1) { 
	animation-name: astroFadeIn, astroSlideFromLeft; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-ion6hrkg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-ion6hrkg-1"] { 
	animation-name: astroFadeIn, astroSlideFromLeft; }</style></head> <body> <main data-astro-transition-scope="astro-ion6hrkg-1"> <!-- Navbar --> <header class=""> <nav class="mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8" aria-label="Global"> <div class="flex lg:flex-1"> <a href="/" class="hoveranimation -m-1.5 flex p-1.5 text-xl normal-case lg:text-3xl"> <span class="sr-only">Corentin GS</span> <svg class="size-16 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <path d="M297.31 360.7q66.63 3.67 132.57 13.74c20.83 3.18 41.57 7.41 62.3 11.19 2.43.45 6.05 3.48 3.87 6.19-1.41 1.74-6.05 1.54-7.8 1.19-64.69-12.87-130.07-20.15-195.94-22.32a.9.9 0 0 0-.83.49q-10.69 21.56-21.72 43.14-2.25 4.4-3.59 5.84c-2.43 2.6-6.88 1.04-7.68-2.4q-.29-1.28.91-4.08 9.3-21.72 18.95-43.2a.25.24 12.7 0 0-.22-.34q-37.42-1.19-74.85-.15a.85.83 11.9 0 0-.72.46q-10.53 21.34-21.4 42.88c-1.11 2.2-2.66 4.85-3.88 6.43-1.83 2.38-5.95 2.08-7.46-.49-1.19-2.02-.09-4.15.77-6.18q8.93-21.13 18.21-42.1.22-.49-.31-.47-33.23 1.27-66.25 4.73-11.49 1.2-12.44 1.41c-8.82 1.96-14.91 9.67-20.99 15.65-15.29 15.04-32.5 29.4-54.81 31.42-9.16.83-24.57-2.63-23-15.3 2.68-21.69 48.7-31.96 65.95-35.88 9.21-2.09 16.58-4.45 21.99-10.87q28.81-34.15 58.31-80.18c54.29-84.7 99.07-176.27 134.91-270.21q1.83-4.79 3.32-6.3c3.68-3.72 12.27-3.05 11.83 4-.27 4.39-2.39 11.12-4.31 16.12q-36.79 95.54-86.1 185.26c-27.83 50.64-58.74 99.64-94.28 145.26q-2.35 3.01-3.77 6.72a1.86 1.86 0 0 0 1.1 2.42q2.26.82 5.05.46 33.99-4.41 68.2-5.75a1.24 1.24 0 0 0 1.07-.71q12.27-26.59 24.88-53.01c6.84-14.32 12.76-28.9 18.96-43.44.68-1.59 2.48-5.63 4.01-6.46 2.9-1.58 7.47-1.21 8.95 2.08 1.72 3.86-1.8 7.32-.18 10.55q.21.43.68.53c2.86.58 5.64-2.41 7.59-3.35 10.03-4.8 25.53-12.43 33.41-1.76q1.24 1.68 3.45 7.38c1.44 3.72 8.7 2.23 11.68 1.46q8.07-2.1 16.26-3.79a1 .98-83.3 0 0 .7-.56q1.39-3.1 2.84-6.19c2.08-4.39 3-7.71 8.02-7.23 6.89.66 5.35 6.43 4.23 10.98a2.31 2.29-46.6 0 0 .03 1.21q.99 3.17 4.2 1.25c9.75-5.8 30.32-17.06 38.62-3.33q1.4 2.31 2.59 5.92c1.92 5.8 19.02.22 23.45-1.04q4.7-1.33 10.05-.81a1.7 1.7 0 0 1 1.52 1.48c.33 2.64-1.31 2.93-3.27 3.61q-14.99 5.24-30.04 10.33c-4.78 1.62-7.64 7.86-10.62 11.6-12.76 16.07-35.92 21.17-55.29 21.07q-.51-.01-.91.3c-4.01 3.06-7.16 9.79-9.39 14.45-4.51 9.41-9.19 18.72-13.72 28.12q-.26.55.34.58Zm-23.37-92.28q-23.22 11.53-37.03 32.48-1.02 1.54-1.04 2.95a1.29 1.29 0 0 0 1.7 1.25q7.46-2.48 14.22-6.54 5.81-3.49 26.05-16.5 2.5-1.6 3.36-3.56 2.02-4.63-.43-9.74a1.47 1.45-.4 0 0-.72-.7q-2.84-1.27-6.11.36Zm58.87 34.43c12.01-5.89 22.8-13.69 34.17-20.68q2.52-1.55 3.4-3.5c1.87-4.13 1.19-14.21-6.39-10.64q-23.66 11.14-38.03 33.39-.77 1.19-.88 2.43a1.11 1.11 0 0 0 1.34 1.19q3.47-.76 6.39-2.19Zm-11.58-26.03q.12-.28-.17-.19-10.66 3.56-21.39 7.27c-7.4 2.56-8.66 7.47-13.17 12.96-12.74 15.54-35.85 20.49-54.86 20.4q-.5-.01-.9.32c-4.8 3.94-8.83 13.11-11.33 18.39q-5.38 11.4-10.95 22.61a.23.22 12 0 0 .21.32c24.67-.59 49.15.07 73.82.93q.52.02.74-.45c12.73-27.53 26.11-54.68 38-82.56ZM72.01 386.45c-14.21.93-29.09 6.14-40.21 15.2-8.15 6.63-3.92 15.07 6.69 10.88q20.65-8.14 33.79-25.57.41-.55-.27-.51Z"></path> </svg> </a> </div> <div class="flex lg:hidden"> <label for="my-modal-6" class="btn btn-ghost lg:hidden"> <svg class="inline-block size-6 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path> </svg> </label> </div> <div class="hidden lg:flex lg:gap-x-12"> <a href="/projects" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Projects</a> <a href="/talks" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Talks</a> <a href="/experiences" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Experiences</a> <a href="/blog" data-astro-prefetch="hover" class="text-md font-semibold leading-6">Articles</a> </div> <div class="hidden lg:flex lg:flex-1 lg:justify-end"> <button class="btn btn-ghost" onclick="my_modal_1.showModal()"> <svg viewBox="0 0 24 24" class="size-6" astro-icon="lucide:settings"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2"/><circle cx="12" cy="12" r="3"/></g></svg> </button> <dialog id="my_modal_1" class="modal"> <div class="modal-box"> <!-- Modal header --> <div class="flex items-center justify-between rounded-t border-b p-4 md:p-5"> <h3 class="text-lg font-semibold">Customize your experience</h3> <form method="dialog"> <button class="btn btn-ghost" data-modal-close> <svg class="size-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </form> </div> <!-- Modal body --> <form action="#" class="p-4 md:p-5"> <div class="mb-4 grid grid-cols-2 gap-4"> <div class="col-span-2"> <label for="theme" class="mb-2 block text-sm font-medium">Theme</label> <select data-choose-theme id="theme-select" name="theme-option" class="select select-bordered select-secondary select-md max-w-xs bg-base-200 text-base-content"> <option disabled selected>Pick your theme</option> <option value="light">Light</option><option value="dark">Dark</option><option value="dracula">Dracula</option><option value="memnix">Memnix</option><option value="luxury">Luxury</option><option value="cyberpunk">Cyberpunk</option><option value="black">Black</option> </select>   </div> </div> </form> </div> <form method="dialog" class="modal-backdrop"> <button>close</button> </form> </dialog> </div> </nav> <!-- Main modal --> <!-- Mobile menu, show/hide based on menu open state. --> </header> <!-- Page Slot --> <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none relative"> <div class="hoveranimation absolute left-5 top-[0.5rem] z-10 hidden lg:block"> <a href="/blog" class="btn btn-ghost text-xl md:text-2xl lg:text-3xl" data-astro-prefetch="hover"> <svg viewBox="0 0 24 24" class="h-10 w-10" astro-icon="lucide:arrow-left"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19-7-7 7-7m7 7H5"/></svg> </a> </div> <div class="mx-auto mt-12 max-w-screen-lg px-4 text-lg leading-relaxed lg:px-0"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published
<time class="text-sm font-bold text-opacity-60" datetime="2023-01-11T23:00:00.000Z"> Jan 12, 2023 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 7 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Goroutine vs Simple function </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Optimization </span> </div><div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Benchmark </span> </div><div> <span class="bg-secondary font-semibold shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full text-secondary-content"> Golang </span> </div> </div> </header> <picture> <source srcset="/_astro/simple-go-vs-goroutines.UC2nTv5T_A4zjQ.webp" type="image/webp"><source srcset="/_astro/simple-go-vs-goroutines.UC2nTv5T_VPIiC.avif" type="image/avif"> <img src="/_astro/simple-go-vs-goroutines.UC2nTv5T_1INyjO.png" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Goroutine vs Simple function" width="1000" height="500" decoding="async"> </picture> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://corentings.dev/blog/simple-go-vs-goroutines/" aria-label="Share on Twitter"> <svg viewBox="0 0 24 24" class="hoveranimation size-6" astro-icon="ri:twitter-x-fill"><path fill="currentColor" d="M18.205 2.25h3.308l-7.227 8.26 8.502 11.24H16.13l-5.214-6.817L4.95 21.75H1.64l7.73-8.835L1.215 2.25H8.04l4.713 6.231zm-1.161 17.52h1.833L7.045 4.126H5.078z"/></svg> </a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://corentings.dev/blog/simple-go-vs-goroutines/" aria-label="Share on LinkedIn"> <svg viewBox="0 0 24 24" class="hoveranimation size-6" astro-icon="lucide:linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg> </a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs"> <h2 class="font-bold mb-3 text-2xl">Index</h2> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#goroutine-vs-simple-function" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Goroutine vs Simple function </a>  </li><li class="flex flex-col"> <a href="#structures" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Structures </a>  </li><li class="flex flex-col"> <a href="#conversion" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Conversion </a>  </li><li class="flex flex-col"> <a href="#use-case" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Use case </a>  </li><li class="flex flex-col"> <a href="#simple-function" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Simple function </a>  </li><li class="flex flex-col"> <a href="#goroutine-without-mutex" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Goroutine without mutex </a>  </li><li class="flex flex-col"> <a href="#goroutine-with-mutex" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Goroutine with mutex </a>  </li><li class="flex flex-col"> <a href="#benchmark" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Benchmark </a>  </li><li class="flex flex-col"> <a href="#why" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Why ? </a>  </li><li class="flex flex-col"> <a href="#conclusion" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Conclusion </a>  </li><li class="flex flex-col"> <a href="#code" class="bg-base-200 hover:bg-indigo-300 py-1 px-4 rounded-full mb-2 first-letter:uppercase w-fit line-clamp-1"> Code </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full text-justify"> <h2 id="goroutine-vs-simple-function">Goroutine vs Simple function</h2>
<p>This is a simple example of why goroutines might be <strong>overkill</strong> for some tasks and less efficient than a simple function.</p>
<br/>
<h2 id="structures">Structures</h2>
<p>We got a simple structure that contains sensitive information that we don’t want to be exposed to the outside world.
Therefore, we created a second structure that hides the sensitive information and only exposes the information we want to be public.</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#676E95;font-style:italic">// Pineapple is a struct that represents a database object with sensitive data that should be hidden</span></span>
<span class="line"><span style="color:#89DDFF">type</span><span style="color:#FFCB6B"> Pineapple</span><span style="color:#89DDFF"> struct</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">	Paro       </span><span style="color:#C792EA">string</span><span style="color:#89DDFF"> `</span><span style="color:#C3E88D">faker:&quot;name&quot;</span><span style="color:#89DDFF">`</span></span>
<span class="line"><span style="color:#BABED8">	Turkey     </span><span style="color:#C792EA">string</span><span style="color:#89DDFF"> `</span><span style="color:#C3E88D">faker:&quot;name&quot;</span><span style="color:#89DDFF">`</span></span>
<span class="line"><span style="color:#BABED8">	Banana     </span><span style="color:#C792EA">string</span><span style="color:#89DDFF"> `</span><span style="color:#C3E88D">faker:&quot;name&quot;</span><span style="color:#89DDFF">`</span></span>
<span class="line"><span style="color:#BABED8">	Age        </span><span style="color:#C792EA">int</span><span style="color:#89DDFF">    `</span><span style="color:#C3E88D">faker:&quot;number&quot;</span><span style="color:#89DDFF">`</span></span>
<span class="line"><span style="color:#BABED8">	Size       </span><span style="color:#C792EA">int</span><span style="color:#89DDFF">    `</span><span style="color:#C3E88D">faker:&quot;number&quot;</span><span style="color:#89DDFF">`</span></span>
<span class="line"><span style="color:#BABED8">	IsAlive    </span><span style="color:#C792EA">bool</span></span>
<span class="line"><span style="color:#BABED8">	ID         </span><span style="color:#C792EA">uint</span></span>
<span class="line"><span style="color:#BABED8">	SecretCode </span><span style="color:#89DDFF">[]</span><span style="color:#C792EA">byte</span></span>
<span class="line"><span style="color:#BABED8">	Created    </span><span style="color:#FFCB6B">time</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">Time</span></span>
<span class="line"><span style="color:#BABED8">	Updated    </span><span style="color:#FFCB6B">time</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">Time</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">// SafePineApple is a struct that represents a Pineapple object without sensitive data</span></span>
<span class="line"><span style="color:#89DDFF">type</span><span style="color:#FFCB6B"> SafePineApple</span><span style="color:#89DDFF"> struct</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">    Paro    </span><span style="color:#C792EA">string</span></span>
<span class="line"><span style="color:#BABED8">    Turkey  </span><span style="color:#C792EA">string</span></span>
<span class="line"><span style="color:#BABED8">    Banana  </span><span style="color:#C792EA">string</span></span>
<span class="line"><span style="color:#BABED8">    IsAlive </span><span style="color:#C792EA">bool</span></span>
<span class="line"><span style="color:#BABED8">    Age     </span><span style="color:#C792EA">int</span></span>
<span class="line"><span style="color:#BABED8">    ID      </span><span style="color:#C792EA">uint</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<h2 id="conversion">Conversion</h2>
<p>We need to convert our Pineapple object to a SafePineApple object.
We can do this by creating a method on the Pineapple struct that returns a SafePineApple object.</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#676E95;font-style:italic">// ToSafePineApple converts a Pineapple object to a SafePineApple object</span></span>
<span class="line"><span style="color:#89DDFF">func</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">p </span><span style="color:#89DDFF">*</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#82AAFF"> ToSafePineApple</span><span style="color:#89DDFF">()</span><span style="color:#FFCB6B"> SafePineApple</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	return</span><span style="color:#FFCB6B"> SafePineApple</span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#BABED8">		Paro</span><span style="color:#89DDFF">:</span><span style="color:#BABED8">    p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">Paro</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8">		Turkey</span><span style="color:#89DDFF">:</span><span style="color:#BABED8">  p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">Turkey</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8">		Banana</span><span style="color:#89DDFF">:</span><span style="color:#BABED8">  p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">Banana</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8">		IsAlive</span><span style="color:#89DDFF">:</span><span style="color:#BABED8"> p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">IsAlive</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8">		Age</span><span style="color:#89DDFF">:</span><span style="color:#BABED8">     p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">Age</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8">		ID</span><span style="color:#89DDFF">:</span><span style="color:#BABED8">      p</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">ID</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<h2 id="use-case">Use case</h2>
<p>In our use case we have an <strong>array of Pineapple objects</strong> coming from our database that we want to convert to <strong>SafePineApple objects</strong> and store them in a <strong>new array</strong>.
The <strong>order of the objects</strong> in the array should be the same as the original array as it has already been sorted by a sql query.</p>
<br/>
<h2 id="simple-function">Simple function</h2>
<p>We can do this by creating a simple function that takes an array of Pineapple objects and returns an array of SafePineApple objects.</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#676E95;font-style:italic">// SimpleConvertPineApplesToSafety converts an array of Pineapple objects to an array of SafePineApple objects</span></span>
<span class="line"><span style="color:#89DDFF">func</span><span style="color:#82AAFF"> SimpleConvertPineApplesToSafety</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">pineapples</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">	safePineApples </span><span style="color:#89DDFF">:=</span><span style="color:#82AAFF"> make</span><span style="color:#89DDFF">([]</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	for</span><span style="color:#BABED8"> idx</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> pineapple </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#BABED8"> pineapples </span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#BABED8">		safePineApples</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">idx</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pineapple</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ToSafePineApple</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	return</span><span style="color:#BABED8"> safePineApples</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<p>This function is very <strong>simple</strong> and <strong>easy to understand</strong>. We loop through the array of Pineapple objects and convert them to SafePineApple objects.</p>
<br/>
<h2 id="goroutine-without-mutex">Goroutine without mutex</h2>
<p>We can do this by using <strong>goroutines</strong> to work on the array concurrently and store the results in a new array.</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#89DDFF">func</span><span style="color:#82AAFF"> GoroutinesNoMutexConvertPineApplesToSafety</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">pineapples</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Create a slice to store the SafePineApples</span></span>
<span class="line"><span style="color:#BABED8">	safePineApples </span><span style="color:#89DDFF">:=</span><span style="color:#82AAFF"> make</span><span style="color:#89DDFF">([]</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)</span><span style="color:#BABED8">)</span></span>
<span class="line"><span style="color:#BABED8">	safePineApples2 </span><span style="color:#89DDFF">:=</span><span style="color:#82AAFF"> make</span><span style="color:#89DDFF">([]</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF">	var</span><span style="color:#BABED8"> wg </span><span style="color:#FFCB6B">sync</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">WaitGroup</span><span style="color:#676E95;font-style:italic"> // Create a WaitGroup to wait for all goroutines to finish</span></span>
<span class="line"><span style="color:#BABED8">	wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Add</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF">)</span><span style="color:#676E95;font-style:italic">            // Add 1 to the WaitGroup</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Create a goroutine to convert the first half of the Pineapple objects</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	go</span><span style="color:#89DDFF"> func(</span><span style="color:#BABED8;font-style:italic">chunk</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		defer</span><span style="color:#BABED8"> wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Done</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Decrement the WaitGroup when the goroutine is done</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		for</span><span style="color:#BABED8"> idx</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> pineapple </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#BABED8"> chunk </span><span style="color:#89DDFF">{</span><span style="color:#676E95;font-style:italic"> // Loop through the chunk of Pineapple objects</span></span>
<span class="line"><span style="color:#BABED8">			safePineApples</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">idx</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pineapple</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ToSafePineApple</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Convert the Pineapple object to a SafePineApple object</span></span>
<span class="line"><span style="color:#89DDFF">		}</span></span>
<span class="line"><span style="color:#89DDFF">	}(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">[:</span><span style="color:#82AAFF">len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#89DDFF">])</span><span style="color:#676E95;font-style:italic"> // Pass the first half of the Pineapple objects to the goroutine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Convert the second half of the Pineapple objects in the main thread</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	for</span><span style="color:#BABED8"> idx</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> pineapple </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#BABED8"> pineapples</span><span style="color:#89DDFF">[</span><span style="color:#82AAFF">len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#89DDFF">:]</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">		safePineApples2</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">idx</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pineapple</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ToSafePineApple</span><span style="color:#89DDFF">()</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Wait for all goroutines to finish</span></span>
<span class="line"><span style="color:#BABED8">	wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Wait</span><span style="color:#89DDFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Group both pineapples</span></span>
<span class="line"><span style="color:#BABED8">	safePineApples </span><span style="color:#89DDFF">=</span><span style="color:#82AAFF"> append</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">safePineApples</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> safePineApples2</span><span style="color:#89DDFF">...)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Return the SafePineApples</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	return</span><span style="color:#BABED8"> safePineApples</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<p>This function is a bit more <strong>complex</strong> than the simple function. We use a goroutine to convert the first half while the other half is handled by the main thread.
We use a <strong>WaitGroup</strong> to wait for the goroutine to finish before returning the results.</p>
<br/>
<h2 id="goroutine-with-mutex">Goroutine with mutex</h2>
<p>We can also add <strong>mutexes</strong> to the goroutine to make it <strong>thread safe</strong>.</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#89DDFF">func</span><span style="color:#82AAFF"> GoroutinesConvertPineApplesToSafety</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">pineapples</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Create a slice to store the SafePineApples</span></span>
<span class="line"><span style="color:#BABED8">	safePineApples </span><span style="color:#89DDFF">:=</span><span style="color:#82AAFF"> make</span><span style="color:#89DDFF">([]</span><span style="color:#FFCB6B">SafePineApple</span><span style="color:#89DDFF">,</span><span style="color:#82AAFF"> len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Split the offers into chunks</span></span>
<span class="line"><span style="color:#BABED8">	chunks </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF"> [][]</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">{</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">[:</span><span style="color:#82AAFF">len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#89DDFF">],</span><span style="color:#BABED8"> pineapples</span><span style="color:#89DDFF">[</span><span style="color:#82AAFF">len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineapples</span><span style="color:#89DDFF">)/</span><span style="color:#F78C6C">2</span><span style="color:#89DDFF">:]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">	mutex </span><span style="color:#89DDFF">:=</span><span style="color:#FFCB6B"> sync</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">Mutex</span><span style="color:#89DDFF">{}</span><span style="color:#676E95;font-style:italic"> // Create a mutex to lock the slice when writing to it</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF">	var</span><span style="color:#BABED8"> wg </span><span style="color:#FFCB6B">sync</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">WaitGroup</span><span style="color:#676E95;font-style:italic"> // Create a WaitGroup to wait for all goroutines to finish</span></span>
<span class="line"><span style="color:#BABED8">	wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Add</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF">)</span><span style="color:#676E95;font-style:italic">           // Add 1 to the WaitGroup</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Create a goroutine to convert the first half of the Pineapple objects</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	go</span><span style="color:#89DDFF"> func(</span><span style="color:#BABED8;font-style:italic">chunk</span><span style="color:#89DDFF"> []</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		defer</span><span style="color:#BABED8"> wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Done</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Decrement the WaitGroup when the goroutine is done</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">		for</span><span style="color:#BABED8"> idx</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> pineapple </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#BABED8"> chunk </span><span style="color:#89DDFF">{</span><span style="color:#676E95;font-style:italic"> // Loop through the chunk of Pineapple objects</span></span>
<span class="line"><span style="color:#BABED8">			mutex</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Lock</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Lock the mutex</span></span>
<span class="line"><span style="color:#BABED8">			safePineApples</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">idx</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pineapple</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ToSafePineApple</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Convert the Pineapple object to a SafePineApple object</span></span>
<span class="line"><span style="color:#BABED8">			mutex</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Unlock</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic">  // Unlock the mutex</span></span>
<span class="line"><span style="color:#89DDFF">		}</span></span>
<span class="line"><span style="color:#89DDFF">	}(</span><span style="color:#BABED8">chunks</span><span style="color:#89DDFF">[</span><span style="color:#F78C6C">0</span><span style="color:#89DDFF">])</span><span style="color:#676E95;font-style:italic"> // Pass the first half of the Pineapple objects to the goroutine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Convert the second half of the Pineapple objects in the main thread</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	for</span><span style="color:#BABED8"> idx</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> pineapple </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#BABED8"> chunks</span><span style="color:#89DDFF">[</span><span style="color:#F78C6C">1</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">		mutex</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Lock</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Lock the mutex</span></span>
<span class="line"><span style="color:#BABED8">		safePineApples</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">idx</span><span style="color:#89DDFF">+</span><span style="color:#82AAFF">len</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">chunks</span><span style="color:#89DDFF">[</span><span style="color:#F78C6C">0</span><span style="color:#89DDFF">])]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pineapple</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">ToSafePineApple</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Convert the Pineapple object to a SafePineApple object</span></span>
<span class="line"><span style="color:#BABED8">		mutex</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Unlock</span><span style="color:#89DDFF">()</span><span style="color:#676E95;font-style:italic"> // Unlock the mutex</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic">	// Wait for all goroutines to finish</span></span>
<span class="line"><span style="color:#BABED8">	wg</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Wait</span><span style="color:#89DDFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	return</span><span style="color:#BABED8"> safePineApples</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<p>This function make use of the mutex to lock the slice when writing to it.
This makes sure that the goroutine and the main thread don’t write to the same index at the same time but instead wait for the other to finish.</p>
<br/>
<h2 id="benchmark">Benchmark</h2>
<p>Now that we have our functions we can benchmark them to see which one is the <strong>fastest.</strong>
To benchmark our functions we run them with arrays of different sizes.</p>
<p>Our benchmark function looks like this:</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#89DDFF">func</span><span style="color:#82AAFF"> Benchmark_SimpleConvertPineApplesToSafety</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">b</span><span style="color:#89DDFF"> *</span><span style="color:#FFCB6B">testing</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">B</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">	for</span><span style="color:#BABED8"> _</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> n </span><span style="color:#89DDFF">:=</span><span style="color:#89DDFF;font-style:italic"> range</span><span style="color:#89DDFF"> []</span><span style="color:#C792EA">int</span><span style="color:#89DDFF">{</span><span style="color:#F78C6C">500</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 1000</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 2000</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 5000</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 10000</span><span style="color:#89DDFF">}</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">		b</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Run</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">fmt</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Sprintf</span><span style="color:#89DDFF">(</span><span style="color:#89DDFF">&quot;</span><span style="color:#C3E88D">Benchmark_SimpleConvertPineApplesToSafety-</span><span style="color:#F07178">%d</span><span style="color:#89DDFF">&quot;</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> n</span><span style="color:#89DDFF">),</span><span style="color:#89DDFF"> func(</span><span style="color:#BABED8;font-style:italic">b</span><span style="color:#89DDFF"> *</span><span style="color:#FFCB6B">testing</span><span style="color:#89DDFF">.</span><span style="color:#FFCB6B">B</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">			pineApples </span><span style="color:#89DDFF">:=</span><span style="color:#82AAFF"> make</span><span style="color:#89DDFF">([]</span><span style="color:#FFCB6B">Pineapple</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> n</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#89DDFF">			var</span><span style="color:#BABED8"> pine </span><span style="color:#FFCB6B">Pineapple</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">			for</span><span style="color:#BABED8"> i </span><span style="color:#89DDFF">:=</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i </span><span style="color:#89DDFF">&lt;</span><span style="color:#BABED8"> n</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF">++</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">				_ </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> faker</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">FakeData</span><span style="color:#89DDFF">(&amp;</span><span style="color:#BABED8">pine</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">				pine</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">Created </span><span style="color:#89DDFF">=</span><span style="color:#BABED8"> time</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">Now</span><span style="color:#89DDFF">().</span><span style="color:#82AAFF">AddDate</span><span style="color:#89DDFF">(</span><span style="color:#F78C6C">0</span><span style="color:#89DDFF">,</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> -</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">				pine</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">ID </span><span style="color:#89DDFF">=</span><span style="color:#C792EA"> uint</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#BABED8">				pine</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">IsAlive </span><span style="color:#89DDFF">=</span><span style="color:#89DDFF"> true</span></span>
<span class="line"><span style="color:#BABED8">				pineApples</span><span style="color:#89DDFF">[</span><span style="color:#BABED8">i</span><span style="color:#89DDFF">]</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> pine</span></span>
<span class="line"><span style="color:#89DDFF">			}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">			for</span><span style="color:#BABED8"> i </span><span style="color:#89DDFF">:=</span><span style="color:#F78C6C"> 0</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i </span><span style="color:#89DDFF">&lt;</span><span style="color:#BABED8"> b</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">N</span><span style="color:#89DDFF">;</span><span style="color:#BABED8"> i</span><span style="color:#89DDFF">++</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#82AAFF">				SimpleConvertPineApplesToSafety</span><span style="color:#89DDFF">(</span><span style="color:#BABED8">pineApples</span><span style="color:#89DDFF">)</span></span>
<span class="line"><span style="color:#89DDFF">			}</span></span>
<span class="line"><span style="color:#89DDFF">		})</span></span>
<span class="line"><span style="color:#89DDFF">	}</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre> 
<br/>
<p>To run the benchmark we use the following command:</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#FFCB6B">go</span><span style="color:#C3E88D"> test</span><span style="color:#C3E88D"> -bench=.</span><span style="color:#C3E88D"> -benchtime</span><span style="color:#F78C6C"> 5</span><span style="color:#C3E88D">s</span><span style="color:#89DDFF"> &gt;</span><span style="color:#C3E88D"> benchmark.txt</span><span style="color:#89DDFF"> &amp;&amp;</span><span style="color:#FFCB6B"> benchstat</span><span style="color:#C3E88D"> benchmark.txt</span></span></code></pre> 
<br/>
<p>Benchstat is a tool that can be used to compare the results of benchmarks.</p>
<p>The results of the benchmark are as follows:</p>
<pre class="relative shadow-2xl bg-black code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit hover:text-indigo-400">COPY</button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-300 max-w-full max-h-fit ">CHECK</span><code><span class="line"><span style="color:#FFCB6B">name</span><span style="color:#C3E88D">                                                                        time/op</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_SimpleConvertPineApplesToSafety-500-32</span><span style="color:#F78C6C">                          15.8</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_SimpleConvertPineApplesToSafety-1000-32</span><span style="color:#F78C6C">                         32.0</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_SimpleConvertPineApplesToSafety-2000-32</span><span style="color:#F78C6C">                         66.5</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_SimpleConvertPineApplesToSafety-5000-32</span><span style="color:#F78C6C">                          193</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_SimpleConvertPineApplesToSafety-10000-32</span><span style="color:#F78C6C">                         465</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_GoroutinesConvertPineApplesToSafety-500-32</span><span style="color:#F78C6C">                      23.5</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_GoroutinesConvertPineApplesToSafety-1000-32</span><span style="color:#F78C6C">                     46.2</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_GoroutinesConvertPineApplesToSafety-2000-32</span><span style="color:#F78C6C">                     87.7</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_GoroutinesConvertPineApplesToSafety-5000-32</span><span style="color:#F78C6C">                      242</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_GoroutinesConvertPineApplesToSafety-10000-32</span><span style="color:#F78C6C">                     507</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_NoMutexGoroutinesConvertPineApplesToSafety-500-32</span><span style="color:#F78C6C">               28.3</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_NoMutexGoroutinesConvertPineApplesToSafety-1000-32</span><span style="color:#F78C6C">              48.7</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_NoMutexGoroutinesConvertPineApplesToSafety-2000-32</span><span style="color:#F78C6C">               105</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_NoMutexGoroutinesConvertPineApplesToSafety-5000-32</span><span style="color:#F78C6C">               257</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span>
<span class="line"><span style="color:#FFCB6B">Benchmark_NoMutexGoroutinesConvertPineApplesToSafety-10000-32</span><span style="color:#F78C6C">              533</span><span style="color:#C3E88D">µs</span><span style="color:#C3E88D"> ±</span><span style="color:#F78C6C"> 0</span><span style="color:#C3E88D">%</span></span></code></pre> 
<br/>
<p>As you can see the <strong>simple function is the fastest</strong>.</p>
<h2 id="why">Why ?</h2>
<p>The reason why the simple function is the fastest is that the process of converting the Pineapple objects to SafePineApple objects is very fast.
The time it takes to create the goroutines and wait for them to finish is longer than the time it takes to convert the Pineapple objects to SafePineApple objects.</p>
<br/>
<p>Furthermore, in our goroutines implementation we have to convert the Pineapple objects then lock the mutex, write to the slice and unlock the mutex.
This is a lot of <strong>overhead for a very simple task</strong>.</p>
<br/>
<h2 id="conclusion">Conclusion</h2>
<p><em>Don’t use goroutines when you don’t need them.</em> That may seem obvious, but it’s easy to forget when you’re trying to optimize your code.
In this example the overhead of creating the goroutines and waiting for them to finish is <strong>longer</strong> than the time it takes to convert the Pineapple objects to SafePineApple objects.</p>
<p>Goroutines are great for tasks that take a <strong>long time to complete</strong> and can be done in parallel.
I would suggest to write the <strong>simplest code possible</strong> and then benchmark it to see if you can improve it using goroutines instead.</p>
<p>Moreover, simple code is <strong>easier to read and maintain</strong> than complex code, that’s why writing complex code might not be necessary if performance is not an issue.
<strong>I’d prefer to have a simple function that takes a few milliseconds longer to complete than a complex function.</strong></p>
<br/>
<h2 id="code">Code</h2>
<p>The code for this article can be found on <a href="https://github.com/CorentinGS/go-teaching/tree/main/goroutines_simple_vs_complex" class="font-bold underline text-accent"> GitHub </a></p> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related articles</h2> <section class="flex flex-col sm:justify-between gap-8"> <div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/docker-and-go.w4KkOz0f_1zw5GA.webp" type="image/webp"><source srcset="/_astro/docker-and-go.w4KkOz0f_Z230FoJ.avif" type="image/avif"> <img src="/_astro/docker-and-go.w4KkOz0f_oIxWV.png" class="w-16 h-16 object-cover rounded-full " alt="img of How to optimize a Go deployment with Docker " width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/docker-and-go/"> How to optimize a Go deployment with Docker  </a> </header> </div><div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/mergesort-parallel.XNL7amaF_ZMFX4k.webp" type="image/webp"><source srcset="/_astro/mergesort-parallel.XNL7amaF_Z28umRf.avif" type="image/avif"> <img src="/_astro/mergesort-parallel.XNL7amaF_Z1TUFgm.png" class="w-16 h-16 object-cover rounded-full " alt="img of Merge Sort using Goroutines" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/mergesort-parallel/"> Merge Sort using Goroutines </a> </header> </div><div class="flex gap-2 "> <div class="min-h-full"> <picture> <source srcset="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_ZLoKBz.webp" type="image/webp"><source srcset="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_WjJs7.avif" type="image/avif"> <img src="/_astro/optimizing-goroutines-sum-of-squares.bWdVtXiZ_2u8xdG.png" class="w-16 h-16 object-cover rounded-full " alt="img of Solving the Sum of Squares Problem: Optimizing Performance" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> <header class="flex justify-center items-center overflow-ellipsis truncate"> <a class="font-medium  hover:underline" href="/blog/optimizing-goroutines-sum-of-squares/"> Solving the Sum of Squares Problem: Optimizing Performance </a> </header> </div> </section> </footer> </article> </div>  </div> </div> </article> <div class="hoveranimation btn btn-accent btn-sm fixed bottom-5 right-5 hidden" id="btn-back-to-top"> <svg viewBox="0 0 24 24" class="size-6" astro-icon="lucide:arrow-up"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12 7-7 7 7m-7 7V5"/></svg> </div> <input type="checkbox" id="my-modal-6" class="modal-toggle"> <label for="my-modal-6" class="modal modal-bottom cursor-pointer sm:modal-middle"> <label class="modal-box relative" for=""> <ul class="menu w-80 overflow-y-auto bg-base-100 p-4"> <li class="py-3"> <select data-choose-theme id="theme-select" name="theme-option" class="select select-bordered select-secondary select-md max-w-xs bg-base-200 text-base-content"> <option disabled selected>Pick your theme</option> <option value="light">Light</option><option value="dark">Dark</option><option value="dracula">Dracula</option><option value="memnix">Memnix</option><option value="luxury">Luxury</option><option value="cyberpunk">Cyberpunk</option><option value="black">Black</option> </select>   </li> <li> <a href="/projects" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Projects</a> </li> <li> <a href="/talks" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Talks</a> </li> <li> <a href="/experiences" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Experiences</a> </li> <li> <a href="/blog" data-astro-prefetch="tap" class="text-md font-semibold leading-6">Articles</a> </li> </ul> </label> </label> </main>  </body> </html>